---
description: How to configure database migrations in the project
globs:
alwaysApply: false
---
# Configuring database migrations

When configuring database in the project, create a `knexfile.ts` file in the root of the project.

```typescript
import type { Knex } from 'knex'
import * as dotenv from 'dotenv'

dotenv.config({ path: '.env' })

const config: Knex.Config = {
  client: 'postgresql',
  connection: {
    host: process.env.DB_HOST,
    port: process.env.DB_PORT,
    database: process.env.DB_NAME,
    user: process.env.DB_USER,
    password: process.env.DB_PASS,
  },
  pool: {
    min: 2,
    max: 10,
  },
  migrations: {
    tableName: 'knex_migrations',
  },
}

export default config
```

## Creating a new migration

Prefix should be timestamp in milliseconds.

```bash
npm run migrate:make 1727115600000_create_users_table
```

## Running migrations

```bash
npm run migrate:latest
```